<!-- search template -->
<template id="my-airport-search-template">

        <style>
            #airports {
                display: none;
                position:fixed;
                background-color:white;
                overflow-y: scroll;
                height: 50%; 
            }
    
            my-airport{
                display: block;
            }
        </style>
    
        <p>Lentokentt√§</p>
        <input id="search"/>
        <div id="airports"></div>
    
    </template>
    <!-- airport template-->
    <template id="my-airport-template">
        <style>
            div {
                cursor: pointer;
            }
            div:hover {
                background-color: midnightblue;
                color: white;
            }
        </style>
        <div><img id="flag-icon" src=""><span id="name"></span> (<span id="country"></span>)</div>
    </template>
    
    <script type="text/javascript">
    
    let myAirportSearchTemplate = document.currentScript.ownerDocument.querySelector('#my-airport-search-template');
    let myAirportTemplate = document.currentScript.ownerDocument.querySelector('#my-airport-template');
    
    class MyAirportSearchElement extends HTMLElement {
    
        constructor(){
    
            super();
    
            let shadowRoot = this.attachShadow({mode: 'open'});
            let html = myAirportSearchTemplate.content.cloneNode(true);
            this.shadowRoot.appendChild(html);
    
            let searchInput = shadowRoot.querySelector('#search');
            const self = this;
    
            searchInput.addEventListener('keyup',() => {
                if(searchInput.value.length > 1){
                    self.removeData();
                    self.getData();
                }
            });
    
            searchInput.addEventListener('blur',() =>{
                self.hideAirports();
            });
        }
    
        getData() {
            fetch('/data.json')
            .then(response => response.json())
            .then(json => {
                let data = json.items;
                data.map(item => {
                    this.renderData(item)
                });
            });
            this.showAirports();
        }
    
        renderData(data) {
            let airport = document.createElement('my-airport');
            airport.setData(data);
    
            const self = this;
            airport.addEventListener("mousedown", () => {
                self.selectAirport(airport);
                self.hideAirports();
            });
    
            this.shadowRoot.querySelector('#airports').appendChild(airport);
        }
    
        removeData(){
            let airports = this.shadowRoot.querySelector('#airports');
            while (airports.firstChild) {
                airports.removeChild(airports.firstChild);
            }
        }
    
        selectAirport(airport){
            this.shadowRoot.querySelector('#search').value = airport.getData().title;
        }
    
        showAirports(){
            this.shadowRoot.querySelector('#airports').style.display = 'block';   
        }
    
        hideAirports(){
            this.shadowRoot.querySelector('#airports').style.display = 'none';  
        }
    
        connectedCallback() {
            console.log('custom element connected');
        }
    
        disconnectedCallback() {}
    }
    
    class MyAirportElement extends HTMLElement {
    
        constructor(){
            super();
            let shadowRoot = this.attachShadow({mode: 'open'});
            let html = myAirportTemplate.content.cloneNode(true);
            this.shadowRoot.appendChild(html);
        }
    
        connectedCallback() {
            console.log('custom airport element connected');
        }
        
        setData(data){
            this._data = data;
            this.shadowRoot.querySelector('#name').textContent = data.title;
            this.shadowRoot.querySelector('#country').textContent = data.country;
            this.shadowRoot.querySelector('#flag-icon').src = 'https://www.countryflags.io/'+data.countryCode+'/flat/24.png'
        }
    
        getData(){
            return this._data;
        }
    }
    
    window.customElements.define('my-element', MyAirportSearchElement);
    window.customElements.define('my-airport', MyAirportElement);
    
    
    </script>